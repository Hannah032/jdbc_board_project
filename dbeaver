-- ğŸ”¹ í…Œì´ë¸” ì‚­ì œ
DROP TABLE comments CASCADE CONSTRAINTS;
DROP TABLE paging CASCADE CONSTRAINTS;
DROP TABLE board CASCADE CONSTRAINTS;
DROP TABLE employee CASCADE CONSTRAINTS;

-- ğŸ”¹ ì‹œí€€ìŠ¤ ì‚­ì œ
DROP SEQUENCE seq_employee;
DROP SEQUENCE seq_board;
DROP SEQUENCE seq_comment;
DROP SEQUENCE seq_paging_id;
DROP SEQUENCE seq_paging_id2;

-- BOARD í…Œì´ë¸” ìƒì„±
CREATE TABLE BOARD (
    BNO        NUMBER          PRIMARY KEY,
    TITLE     VARCHAR2(100)   NOT NULL,
    WRITER    VARCHAR2(100)   NOT NULL,
    CONTENT   CLOB,
    REG_DATE  DATE            DEFAULT SYSDATE NOT NULL,
    UPD_DATE  DATE            DEFAULT SYSDATE NOT NULL
);

-- BOARD í…Œì´ë¸”ì˜ NO ì»¬ëŸ¼ì— ëŒ€í•œ ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE SEQ_BOARD
INCREMENT BY 1
START WITH 1
MINVALUE 1
MAXVALUE 10000 nocache;

DROP SEQUENCE seq_employee;

-- Employee ì‹œí€€ìŠ¤ ìƒì„± (Oracleìš©)
CREATE SEQUENCE SEQ_EMPLOYEE
START WITH 1
INCREMENT BY 1
MINVALUE 1
MAXVALUE 10000
NOCACHE;

DELETE FROM employee;
TRUNCATE TABLE employee;
SELECT bno, user_id FROM employee ORDER BY bno;

-- Employee í…Œì´ë¸” ìƒì„± (Oracleìš©)
CREATE TABLE employee (
    bno INT PRIMARY KEY,
    name VARCHAR2(50) NOT NULL,
    department VARCHAR2(50) NOT NULL,
    bposition VARCHAR2(50) NOT NULL,
    user_id VARCHAR2(50) NOT NULL,    -- ë¡œê·¸ì¸ ì•„ì´ë”” (ê³ ìœ ê°’)
    password VARCHAR2(100) NOT NULL,         -- ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸
    hire_date TIMESTAMP DEFAULT SYSTIMESTAMP,
    upd_date TIMESTAMP DEFAULT SYSTIMESTAMP
);

DROP TABLE employee PURGE;

-- ìƒ˜í”Œ ë°ì´í„° (ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ í¬í•¨)
INSERT ALL
    INTO employee (bno, name, department, bposition, user_id, password) VALUES (SEQ_EMPLOYEE.nextval, 'ê¹€ì² ìˆ˜', 'ê°œë°œíŒ€', 'ì‚¬ì›', 'kim', '123')
    INTO employee (bno, name, department, bposition, user_id, password) VALUES (SEQ_EMPLOYEE.nextval, 'ì´ì˜í¬', 'ì¸ì‚¬íŒ€', 'ëŒ€ë¦¬', 'lee', '123')
    INTO employee (bno, name, department, bposition, user_id, password) VALUES (SEQ_EMPLOYEE.nextval, 'ë°•ë¯¼ìˆ˜', 'ì˜ì—…íŒ€', 'íŒ€ì¥', 'park', '123')
    INTO employee (bno, name, department, bposition, user_id, password) VALUES (SEQ_EMPLOYEE.nextval, 'ì •ìˆ˜ì§„', 'ê°œë°œíŒ€', 'ê³¼ì¥', 'jung', '123')
    INTO employee (bno, name, department, bposition, user_id, password) VALUES (SEQ_EMPLOYEE.nextval, 'ìµœë™ìš±', 'ë§ˆì¼€íŒ…íŒ€', 'ì‚¬ì›', 'choi', '123')
SELECT * FROM dual;


-- 2. ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ (DML)
--    : í…Œì´ë¸”ê³¼ ì‹œí€€ìŠ¤ê°€ ìƒì„±ëœ í›„, ì•„ë˜ INSERT ë¬¸ì„ ì‹¤í–‰í•˜ì—¬ ì´ˆê¸° ë°ì´í„°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
--      í”„ë¡œê·¸ë¨ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë¯¸ë¦¬ ë°ì´í„°ë¥¼ ë„£ì–´ë‘ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

-- BOARD ìƒ˜í”Œ ë°ì´í„°
INSERT INTO board (bNO, TITLE, WRITER, CONTENT) VALUES(SEQ_BOARD.NEXTVAL, 'ì œëª©01', 'ì‘ì„±ì01', 'ë‚´ìš©01');
INSERT INTO board (bNO, TITLE, WRITER, CONTENT) VALUES(SEQ_BOARD.NEXTVAL, 'ì œëª©02', 'ì‘ì„±ì02', 'ë‚´ìš©02');
INSERT INTO board (bNO, TITLE, WRITER, CONTENT) VALUES(SEQ_BOARD.NEXTVAL, 'ì œëª©03', 'ì‘ì„±ì03', 'ë‚´ìš©03');
INSERT INTO board (bNO, TITLE, WRITER, CONTENT) VALUES(SEQ_BOARD.NEXTVAL, 'ì œëª©04', 'ì‘ì„±ì04', 'ë‚´ìš©04');
INSERT INTO board (bNO, TITLE, WRITER, CONTENT) VALUES(SEQ_BOARD.NEXTVAL, 'ì œëª©05', 'ì‘ì„±ì05', 'ë‚´ìš©05');

SELECT seq_employee.nextval FROM dual;
DROP SEQUENCE seq_employee;

-- EMPLOYEE ìƒ˜í”Œ ë°ì´í„°
INSERT INTO employee (bNO, NAME, DEPARTMENT, bPOSITION, HIRE_DATE) VALUES(SEQ_EMPLOYEE.NEXTVAL, 'í™ì”¨', 'ê°œë°œíŒ€', 'ê³¼ì¥', TO_DATE('2020-01-15', 'YYYY-MM-DD'));
INSERT INTO employee (bNO, NAME, DEPARTMENT, bPOSITION, HIRE_DATE) VALUES(SEQ_EMPLOYEE.NEXTVAL, 'ê¹€ì”¨', 'ë””ìì¸íŒ€', 'ëŒ€ë¦¬', TO_DATE('2021-03-20', 'YYYY-MM-DD'));
INSERT INTO employee (bNO, NAME, DEPARTMENT, bPOSITION, HIRE_DATE) VALUES(SEQ_EMPLOYEE.NEXTVAL, 'ë°•ì”¨', 'ì¸ì‚¬íŒ€', 'ì‚¬ì›', TO_DATE('2022-07-10', 'YYYY-MM-DD'));
INSERT INTO employee (bNO, NAME, DEPARTMENT, bPOSITION, HIRE_DATE) VALUES(SEQ_EMPLOYEE.NEXTVAL, 'ìµœì”¨', 'ë§ˆì¼€íŒ…íŒ€', 'íŒ€ì¥', TO_DATE('2019-11-05', 'YYYY-MM-DD'));
INSERT INTO employee (bNO, NAME, DEPARTMENT, bPOSITION, HIRE_DATE) VALUES(SEQ_EMPLOYEE.NEXTVAL, 'ì •ì”¨', 'ê²½ì˜ì§€ì›íŒ€', 'ë¶€ì¥', TO_DATE('2018-05-12', 'YYYY-MM-DD'));

-- ê¸°ì¡´ ëŒ“ê¸€ í…Œì´ë¸”ê³¼ ì‹œí€€ìŠ¤ ì‚­ì œ (ìˆë‹¤ë©´)
-- TABLE comments CASCADE CONSTRAINTS;
--DROP SEQUENCE SEQ_COMMENT;

-- COMMENT í…Œì´ë¸”ì˜ NO ì»¬ëŸ¼ì— ëŒ€í•œ ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE SEQ_COMMENT
INCREMENT BY 1
START WITH 1
MINVALUE 1
MAXVALUE 10000;

-- COMMENTS í…Œì´ë¸” ìƒì„±
CREATE TABLE comments (
    bno NUMBER PRIMARY KEY,
    board_no NUMBER NOT NULL,
    writer VARCHAR2(100) NOT NULL,
    content CLOB,
    reg_date DATE DEFAULT SYSDATE NOT NULL,
    upd_date DATE DEFAULT SYSDATE NOT NULL,
    CONSTRAINT fk_comments_board FOREIGN KEY (board_no) REFERENCES board(bno) ON DELETE CASCADE
);

-- ìƒ˜í”Œ ëŒ“ê¸€ ë°ì´í„° ì¶”ê°€
INSERT INTO comments (bNO, BOARD_NO, WRITER, CONTENT) VALUES(SEQ_COMMENT.NEXTVAL, 1, 'ëŒ“ê¸€ì‘ì„±ì1', 'ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì— ëŒ€í•œ ëŒ“ê¸€ì…ë‹ˆë‹¤.');
INSERT INTO comments (bNO, BOARD_NO, WRITER, CONTENT) VALUES(SEQ_COMMENT.NEXTVAL, 1, 'ëŒ“ê¸€ì‘ì„±ì2', 'ì¢‹ì€ ê¸€ì´ë„¤ìš”!');
INSERT INTO comments (bNO, BOARD_NO, WRITER, CONTENT) VALUES(SEQ_COMMENT.NEXTVAL, 2, 'ëŒ“ê¸€ì‘ì„±ì3', 'ë‘ ë²ˆì§¸ ê²Œì‹œê¸€ ëŒ“ê¸€ì…ë‹ˆë‹¤.');
INSERT INTO comments (bNO, BOARD_NO, WRITER, CONTENT) VALUES(SEQ_COMMENT.NEXTVAL, 3, 'ëŒ“ê¸€ì‘ì„±ì4', 'ì„¸ ë²ˆì§¸ ê²Œì‹œê¸€ì— ëŒ€í•œ ì˜ê²¬ì…ë‹ˆë‹¤.');

-- ê¸°ì¡´ í…Œì´ë¸”ì´ ìˆë‹¤ë©´ ì‚­ì œ
DROP TABLE paging CASCADE CONSTRAINTS;

-- í˜ì´ì§• í…Œì´ë¸” ìƒì„±
CREATE TABLE paging (
    paging_id NUMBER PRIMARY KEY,           -- í˜ì´ì§• ì •ë³´ ID (ì‹œí€€ìŠ¤ ì‚¬ìš©)
    total_count NUMBER NOT NULL,            -- ì „ì²´ ê²Œì‹œê¸€ ìˆ˜
    count_list NUMBER NOT NULL,             -- í•œ í˜ì´ì§€ë‹¹ ê²Œì‹œê¸€ ìˆ˜
    page_num NUMBER NOT NULL,               -- í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
    total_page NUMBER NOT NULL,             -- ì „ì²´ í˜ì´ì§€ ìˆ˜
    start_page NUMBER NOT NULL,             -- ì‹œì‘ í˜ì´ì§€ ë²ˆí˜¸
    end_page NUMBER NOT NULL,               -- ë í˜ì´ì§€ ë²ˆí˜¸
    start_row NUMBER NOT NULL,              -- ì‹œì‘ í–‰ ë²ˆí˜¸ (DB ì¿¼ë¦¬ìš©)
    end_row NUMBER NOT NULL,                -- ë í–‰ ë²ˆí˜¸ (DB ì¿¼ë¦¬ìš©)
    has_next NUMBER(1) DEFAULT 0 NOT NULL,  -- ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ (0: false, 1: true)
    has_prev NUMBER(1) DEFAULT 0 NOT NULL,  -- ì´ì „ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ (0: false, 1: true)
    
    -- ê²€ìƒ‰ ê´€ë ¨ ì»¬ëŸ¼ë“¤
    search_type VARCHAR2(20),               -- ê²€ìƒ‰ íƒ€ì… (title, writer, content, all)
    search_keyword VARCHAR2(200),           -- ê²€ìƒ‰ í‚¤ì›Œë“œ
    
    -- ë©”íƒ€ ì •ë³´
    created_date DATE DEFAULT SYSDATE,      -- ìƒì„±ì¼
    updated_date DATE DEFAULT SYSDATE,      -- ìˆ˜ì •ì¼
    
    -- ì œì•½ì¡°ê±´
    CONSTRAINT chk_paging_count_list CHECK (count_list > 0),
    CONSTRAINT chk_paging_page_num CHECK (page_num > 0),
    CONSTRAINT chk_paging_total_page CHECK (total_page >= 0),
    CONSTRAINT chk_paging_has_next CHECK (has_next IN (0, 1)),
    CONSTRAINT chk_paging_has_prev CHECK (has_prev IN (0, 1))
);

-- ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE seq_paging_id2
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_paging_page_num ON paging(page_num);
CREATE INDEX idx_paging_search ON paging(search_type, search_keyword);
CREATE INDEX idx_paging_created_date ON paging(created_date);

-- í…Œì´ë¸” ì½”ë©˜íŠ¸
COMMENT ON TABLE paging IS 'í˜ì´ì§• ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”';
COMMENT ON COLUMN paging.paging_id IS 'í˜ì´ì§• ì •ë³´ ID (ê¸°ë³¸í‚¤)';
COMMENT ON COLUMN paging.total_count IS 'ì „ì²´ ê²Œì‹œê¸€ ìˆ˜';
COMMENT ON COLUMN paging.count_list IS 'í•œ í˜ì´ì§€ë‹¹ ê²Œì‹œê¸€ ìˆ˜';
COMMENT ON COLUMN paging.page_num IS 'í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸';
COMMENT ON COLUMN paging.total_page IS 'ì „ì²´ í˜ì´ì§€ ìˆ˜';
COMMENT ON COLUMN paging.start_page IS 'ì‹œì‘ í˜ì´ì§€ ë²ˆí˜¸';
COMMENT ON COLUMN paging.end_page IS 'ë í˜ì´ì§€ ë²ˆí˜¸';
COMMENT ON COLUMN paging.start_row IS 'ì‹œì‘ í–‰ ë²ˆí˜¸ (DB ì¿¼ë¦¬ìš©)';
COMMENT ON COLUMN paging.end_row IS 'ë í–‰ ë²ˆí˜¸ (DB ì¿¼ë¦¬ìš©)';
COMMENT ON COLUMN paging.has_next IS 'ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ (0: false, 1: true)';
COMMENT ON COLUMN paging.has_prev IS 'ì´ì „ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ (0: false, 1: true)';
COMMENT ON COLUMN paging.search_type IS 'ê²€ìƒ‰ íƒ€ì… (title, writer, content, all)';
COMMENT ON COLUMN paging.search_keyword IS 'ê²€ìƒ‰ í‚¤ì›Œë“œ';
COMMENT ON COLUMN paging.created_date IS 'ìƒì„±ì¼';
COMMENT ON COLUMN paging.updated_date IS 'ìˆ˜ì •ì¼';

-- =====================================================
-- í˜ì´ì§• ì •ë³´ ì‚½ì… ì˜ˆì‹œ
-- =====================================================

-- 1. ê¸°ë³¸ í˜ì´ì§• ì •ë³´ (ì „ì²´ ê²Œì‹œê¸€ 100ê°œ, í˜ì´ì§€ë‹¹ 10ê°œ, 1í˜ì´ì§€)
INSERT INTO paging (
    paging_id, total_count, count_list, page_num, total_page,
    start_page, end_page, start_row, end_row, has_next, has_prev
) VALUES (
    seq_paging_id.NEXTVAL, 100, 10, 1, 10,
    1, 10, 1, 10, 1, 0
);

-- 2. ê²€ìƒ‰ í˜ì´ì§• ì •ë³´ (ì œëª© ê²€ìƒ‰, ê²€ìƒ‰ ê²°ê³¼ 25ê°œ, í˜ì´ì§€ë‹¹ 5ê°œ, 1í˜ì´ì§€)
INSERT INTO paging (
    paging_id, total_count, count_list, page_num, total_page,
    start_page, end_page, start_row, end_row, has_next, has_prev,
    search_type, search_keyword
) VALUES (
    seq_paging_id.NEXTVAL, 25, 5, 1, 5,
    1, 5, 1, 5, 1, 0,
    'title', 'í…ŒìŠ¤íŠ¸'
);

-- =====================================================
-- í˜ì´ì§• ì •ë³´ ì¡°íšŒ ì¿¼ë¦¬ ì˜ˆì‹œ
-- =====================================================

-- 1. ëª¨ë“  í˜ì´ì§• ì •ë³´ ì¡°íšŒ
SELECT * FROM paging ORDER BY created_date DESC;

-- 2. íŠ¹ì • í˜ì´ì§• ì •ë³´ ì¡°íšŒ
SELECT * FROM paging WHERE paging_id = 1;

-- 3. ê²€ìƒ‰ ì¡°ê±´ë³„ í˜ì´ì§• ì •ë³´ ì¡°íšŒ
SELECT * FROM paging 
WHERE search_type = 'title' 
AND search_keyword = 'í…ŒìŠ¤íŠ¸'
ORDER BY created_date DESC;

-- 4. ìµœê·¼ í˜ì´ì§• ì •ë³´ ì¡°íšŒ (ìµœê·¼ 10ê°œ)
SELECT * FROM paging 
ORDER BY created_date DESC 
FETCH FIRST 10 ROWS ONLY;

-- =====================================================
-- í˜ì´ì§• ì •ë³´ ì—…ë°ì´íŠ¸ ì˜ˆì‹œ
-- =====================================================

-- í˜ì´ì§• ì •ë³´ ì—…ë°ì´íŠ¸
UPDATE paging 
SET total_count = 150,
    total_page = 15,
    end_page = 10,
    end_row = 10,
    has_next = 1,
    updated_date = SYSDATE
WHERE paging_id = 1;

-- =====================================================
-- í˜ì´ì§• ì •ë³´ ì‚­ì œ ì˜ˆì‹œ
-- =====================================================

-- íŠ¹ì • í˜ì´ì§• ì •ë³´ ì‚­ì œ
DELETE FROM paging WHERE paging_id = 1;

-- ì˜¤ë˜ëœ í˜ì´ì§• ì •ë³´ ì‚­ì œ (30ì¼ ì´ì „)
DELETE FROM paging 
WHERE created_date < SYSDATE - 30; 


-- 3. ë°ì´í„° ì¡°ì‘ ë° ì¡°íšŒ ì˜ˆì‹œ (ì„ íƒ ì‚¬í•­)
--    : ì•„ë˜ëŠ” DAO í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œë“¤ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë³¼ ìˆ˜ ìˆëŠ” ì˜ˆì‹œ SQLë¬¸ì…ë‹ˆë‹¤.
--      í•„ìš”ì— ë”°ë¼ ì‹¤í–‰í•˜ì—¬ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


DELETE FROM employee;

-- BOARD ì „ì²´ ì¡°íšŒ
SELECT * FROM board;

-- BOARD ì„ íƒ ì¡°íšŒ (1ë²ˆ ê²Œì‹œê¸€)
SELECT * FROM board WHERE no = 1;

-- BOARD ë°ì´í„° ìˆ˜ì • (1ë²ˆ ê²Œì‹œê¸€)
UPDATE board SET title = 'ìˆ˜ì •ëœ ì œëª©', writer = 'ìˆ˜ì •í•œ ì‘ì„±ì', content = 'ìˆ˜ì •ëœ ë‚´ìš©', upd_date = SYSDATE WHERE no = 1;

-- BOARD ë°ì´í„° ì‚­ì œ (1ë²ˆ ê²Œì‹œê¸€)
DELETE FROM board WHERE no = 1;

-- EMPLOYEE ì „ì²´ ì¡°íšŒ
SELECT * FROM employee;

-- EMPLOYEE ì„ íƒ ì¡°íšŒ (1ë²ˆ ì§ì›)
SELECT * FROM employee WHERE no = 1;

-- EMPLOYEE ë°ì´í„° ìˆ˜ì • (1ë²ˆ ì§ì›)
UPDATE employee SET name = 'ìˆ˜ì •ëœ ì´ë¦„', department = 'ìˆ˜ì •ëœ ë¶€ì„œ', position = 'ìˆ˜ì •ëœ ì§ê¸‰', upd_date = SYSDATE WHERE no = 1;

-- EMPLOYEE ë°ì´í„° ì‚­ì œ (1ë²ˆ ì§ì›)
DELETE FROM employee WHERE no = 1;

-- ëŒ“ê¸€ í…Œì´ë¸” í™•ì¸
SELECT * FROM comments;

-- ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ ì¡°ì¸ ì¡°íšŒ ì˜ˆì‹œ
SELECT b.no as board_no, b.title, b.writer as board_writer, 
       c.no as comment_no, c.writer as comment_writer, c.content as comment_content
FROM board b
LEFT JOIN comments c ON b.no = c.board_no
ORDER BY b.no, c.reg_date;

-- 4. ë³€ê²½ì‚¬í•­ ìµœì¢… ì €ì¥ (TCL)
--    : ëª¨ë“  DML(INSERT, UPDATE, DELETE) ì‘ì—…ì´ ì™„ë£Œëœ í›„, COMMITì„ ì‹¤í–‰í•˜ì—¬ ë³€ê²½ì‚¬í•­ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
COMMIT;
